#!/usr/bin/bash
# vim: set syntax=sh

execName=$(basename $0)

function usageAndExit() {
    echo "Usage: $execName <domain> <command>"
    echo
    echo "Domains:"
    echo "  xelonic"
    echo "  neuland"
    echo
    echo "Commands:"
    echo "  start"
    echo "  stop"
    echo "  status"
    echo "  help"

    exit $1
}

colorOn=${COLOR_ON:-'#00FF00'}
colorOff=${COLOR_OFF:-'#333333'}
label=${LABEL:-'VPN'}

if [ $# -lt 2 ];
then
    usageAndExit 1
fi

domain=$1
command=$2
additionalArg=$3

if [[ "$domain" == "neuland" ]];
then
    case "$command" in
    start)
        nmcli connection up --ask uuid 11124e4d-12f3-49f4-9c06-2cb28aad0c65
        ;;
    stop)
        nmcli connection down uuid 11124e4d-12f3-49f4-9c06-2cb28aad0c65
        ;;
    status)
        tmp=$(nmcli connection show --active uuid 11124e4d-12f3-49f4-9c06-2cb28aad0c65)
        if [ ${#tmp} -lt 1 ]; then
            if [ "$additionalArg" == "-i3" ]; then
                echo "<span color='$colorOff'>$label</span>"
            else
                echo "down"
            fi
        else
            if [ "$additionalArg" == "-i3" ]; then
                echo "<span color='$colorOn'>$label</span>"
            else
                echo "up"
            fi
        fi
        ;;
    help|-h|--help)
        usageAndExit 0
        ;;
    esac
elif [[ "$domain" == "xelonic" ]];
then
    if [[ "$command" == "status" ]];
    then
        if [[ "$additionalArg" == "-v" ]];
        then
            systemctl status openvpn-client@xelonic
        else
            systemctl status openvpn-client@xelonic | grep "active (running)" &> /dev/null
            if [ $? -eq 0 ];
            then
                echo "up"
            else
                echo "down"
            fi
        fi
    else
        sudo systemctl $command openvpn-client@xelonic
    fi
else
    echo "Unknown domain: $command"
    usageAndExit 1
fi
