#!/bin/bash
# vim: set syntax=sh

set -euo pipefail

function usage() {
    echo
    echo "Usage: $(basename $0) <command>"
    echo
    echo "command:"
    echo "  new <branch name>: fetch and checkout origin/master with current changes on top of it"
}

function newBranch() {
    if (( $# < 1 ));
    then
        echo "Too few arguments."
        usage
        exit 1
    fi

    git fetch
    git stash push
    git checkout -b $1 origin/master
    git stash pop
}

if (( $# < 1 ));
then
    usage
    exit 1
fi

case "$1" in
-h|--help)
    usage
    exit 0
    ;;
new)
    shift
    newBranch $1
    ;;
delete)
    currentBranch=$(git branch | grep '*' | sed 's/* //')
    git fetch
    git checkout origin/master
    git branch -d $currentBranch
    ;;
*)
    echo "Unknown argument: $1"
    usage
    exit 1
    ;;
esac
