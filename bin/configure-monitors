#!/bin/bash
# vim: set syntax bash

internalMonitor='eDP1'
externalMonitors='DP2-3 DP2-2 HDMI2'
autoConfigure=0

turnOffExternalMonitors() {
    externalMonitors=$(xrandr | grep 'connected' | grep -v primary | awk '{print $1}')
    for monitor in $externalMonitors;
    do
        xrandr --output "$externalMonitor" --off
    done
}

case "$1" in
-h|--help)
    echo "$(basename $0)"
    echo
    echo "Options:"
    echo "\t--auto: auto-detect monitors and configure them"

    exit 0
    ;;
--auto)
    autoConfigure=1
    ;;
esac

externalMonitorCount=$(xrandr | grep ' connected' | grep -v primary | wc -l)

externalMonitors=$(xrandr | grep ' connected' | grep -v primary | awk '{print $1}')
externalMonitorCount=$(echo "$externalMonitors" | wc -l)

if [[ $externalMonitorCount -lt 1 ]];
then
    turnOffExternalMonitors
elif [[ $externalMonitorCount -lt 2 || $autoConfigure -eq 1 ]];
then
    previousMonitor="$internalMonitor"
    for monitor in $externalMonitors;
    do
        xrandr --output "$monitor" --auto --right-of "$previousMonitor"
        previousMonitor="$monitor"
    done
else
    leftMonitor='DP2-3'
    rightMonitor='DP2-2'
    xrandr --output "$internalMonitor" --off
    xrandr --output "$leftMonitor" --auto
    xrandr --output "$rightMonitor" --auto --right-of "$leftMonitor"
fi

# reconfigure xmodmap
# when connecting the external keyboard linux needs to be told to remap the modmap
[[ -f ~/.Xmodmap_en ]] && xmodmap ~/.Xmodmap_en
[[ -f ~/.Xmodmap_language_independent ]] && xmodmap ~/.Xmodmap_language_independent
